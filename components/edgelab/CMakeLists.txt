# get IDF version for comparison
cmake_minimum_required(VERSION 3.5)
set(idf_version "${IDF_VERSION_MAJOR}.${IDF_VERSION_MINOR}")

FILE(GLOB_RECURSE SRCS_EDGELAB
    ${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp
    ${CMAKE_CURRENT_SOURCE_DIR}/src/*.c
    ${CMAKE_CURRENT_SOURCE_DIR}/third_party/JPEGENC/*.cpp
    ${CMAKE_CURRENT_SOURCE_DIR}/third_party/JPEGENC/*.c
)

set(INCLUDS_EDGELAB
    ${CMAKE_CURRENT_SOURCE_DIR}/src
    ${CMAKE_CURRENT_SOURCE_DIR}/src/porting
    ${CMAKE_CURRENT_SOURCE_DIR}/src/porting/espressif
    ${CMAKE_CURRENT_SOURCE_DIR}/src/repl
    ${CMAKE_CURRENT_SOURCE_DIR}/src/inference
    ${CMAKE_CURRENT_SOURCE_DIR}/src/algorithm
    ${CMAKE_CURRENT_SOURCE_DIR}/src/sensor
    ${CMAKE_CURRENT_SOURCE_DIR}/src/display
    ${CMAKE_CURRENT_SOURCE_DIR}/src/utils
    ${CMAKE_CURRENT_SOURCE_DIR}/third_party/JPEGENC
)

message(STATUS "SRCS_EDGELAB: ${SRCS_EDGELAB}")
message(STATUS "INCLUDS_EDGELAB: ${INCLUDS_EDGELAB}")

set(priv_req tflite-lib screen)

# include component requirements which were introduced after IDF version 4.1
if("${IDF_VERSION_MAJOR}.${IDF_VERSION_MINOR}" VERSION_GREATER "4.1")
    list(APPEND priv_req esp_timer driver)
endif()

idf_component_register(
            SRCS "${SRCS_EDGELAB}"
            INCLUDE_DIRS "${INCLUDS_EDGELAB}"
            REQUIRES ${pub_req}
            PRIV_REQUIRES ${priv_req})

